<!doctype html>
<html>
	<%- include ../block/head_start %>
		<meta name="keywords" content="template">
		<meta name="description" content="template">
		<title>template</title>
	<%- include ../block/head_end %>
	<body>
		<%- include ../block/body_header %>
		<%- include ../block/body_banner %>
		<section class="section cls">
			<div class="markdown-artical">
				<h1><%= title %></h1>
				<h1>hbs-test</h1>

<h3>模板引擎 handlebars</h3>

<p>前端常用模板引擎handlebars，因此我服务器也选择handlebars当模板引擎，便于统一管理</p>

<h3>服务器安装handlebars</h3>

<p>服务器我选择nodejs来开发，因此handlebars选用hbs <br />
以下是基于nodejs操作，请先安装nodejs,npm等等</p>

<pre><code>npm install hbs --save-dev
</code></pre>

<p>安装hbs到自己项目中，并写入包配置文件</p>

<h3>hbs的layout问题</h3>

<p>服务器采用experss框架来搭建，内置渲染layout,文件名layout.something,something代表任何后缀名 <br />
本测试为了方便阅读开发，将采用html为后缀名 <br />
设置本项目开始路径为/,有如下文件
/views/layout.html </p>

<pre><code>&lt;html&gt;
    &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt; 
        &lt;title&gt;无标题&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        {{{body}}}
        &lt;hr/&gt;
        注意标题-title
        我在layout页面
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>其中"{{{body}}}"会替换成你需要渲染的页面文件，暂时"{{{body}}}"为固定，不予改动</p>

<h3>配置启动文件,并测试express的layout文件</h3>

<p>/index.js</p>

<pre><code>var express = require("express")
, path = require("path")
, hbs = require("hbs");

var app = express();

app.set("view engine", "html"); // 方便阅读设置为html
app.set("views", path.join(__dirname+"/views"));
app.engine("html", hbs.__express);

app.get("/", function(req, res){
    res.render("index", {
        title: "首页",
        index_value: "这里是首页提供的变量值lalala"
    })
})
app.get("/test/", function(req, res){
    res.render("test", {
        title: "测试页面",
        test_value: "这是测试给出的一个变量值lalala"
    })
})

app.listen(3000);
console.log("listen to 3000");
</code></pre>

<p>/views/index.html</p>

<pre><code>&lt;h1&gt;我在首页&lt;/h1&gt;
&lt;hr/&gt;
&lt;p&gt;服务器给我的值：{{index_value}}&lt;/p&gt;
&lt;p&gt;这里是首页啊&lt;/p&gt;
</code></pre>

<p>/views/test.html</p>

<pre><code>&lt;h1&gt;我在测试页&lt;/h1&gt;
&lt;hr/&gt;
&lt;p&gt;服务器给我的值：{{test_value}}&lt;/p&gt;
&lt;p&gt;这里是测试页啊&lt;/p&gt;
</code></pre>

<ul>
<li>访问地址：首页：127.0.0.1:3000/ <br />
<img src="/common/img/2015/01/28/index.jpg" alt="首页" title="" />  </li>
<li>访问地址：测试页：127.0.0.1:3000/test/
<img src="/common/img/2015/01/28/test.jpg" alt="测试" title="" />  </li>
</ul>

<h3>自定义hbs的模块文件</h3>

<p>本人喜欢的模块有: (模块存放路径/views/block/*)
+ head<em>start.html head头部模板，主要用来控制meta
+ head</em>end.html head尾部模板，主要用来加载css、js
+ body<em>banner.html banner模板
+ body</em>header.html 头部模板
+ body_footer.html 尾部模板</p>

<p>views/block/head_start.html</p>

<pre><code>&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
</code></pre>

<p>views/block/head_end.html</p>

<pre><code>    &lt;link rel="stylesheet" type="text/css" href="/public/css/style.css"&gt;
    &lt;script src="/public/js/jquery.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;
</code></pre>

<p>views/block/body_start.html</p>

<pre><code>&lt;body&gt;
    &lt;header class="header"&gt;
        &lt;div&gt;
            &lt;nav class="nav"&gt;
                &lt;a href="/"&gt;首页&lt;/a&gt;
                &lt;a href="/test/"&gt;测试页面&lt;/a&gt;
            &lt;/nav&gt;
        &lt;/div&gt;
    &lt;/header&gt;
</code></pre>

<p>views/block/body_banner.html</p>

<pre><code>    &lt;div class="banner"&gt;&lt;/div&gt;
</code></pre>

<p>views/block/body_footer.html</p>

<pre><code>    &lt;footer class="footer"&gt;Copyright (C) 2015-2015 *.*, All rights reserved&lt;/footer&gt;
&lt;/body&gt;
</code></pre>

<p>定义完文件，开始配置hbs的模块控制
在/index.js的添加： <br />
(注意：此处的模块读取是缓存到服务器，修改模块后需要重启服务器，如需自动读取最新模块，请自己写自动读取模块的程序~~~~)</p>

<pre><code>hbs.registerPartial("head_start", fs.readFileSync(__dirname+"/views/block/head_start.html", "utf-8"));
hbs.registerPartial("head_end", fs.readFileSync(__dirname+"/views/block/head_end.html", "utf-8"));
hbs.registerPartial("body_header", fs.readFileSync(__dirname+"/views/block/body_header.html", "utf-8"));
hbs.registerPartial("body_banner", fs.readFileSync(__dirname+"/views/block/body_banner.html", "utf-8"));
hbs.registerPartial("body_footer", fs.readFileSync(__dirname+"/views/block/body_footer.html", "utf-8"));
</code></pre>

<p>hbs模块配置完成后，开始调用，将在layout调用，重构layout</p>

<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
    {{&gt; head_start}}
        &lt;title&gt;{{title}}&lt;/title&gt;
    {{&gt; head_end}}
    {{&gt; body_header}}
    {{&gt; body_banner}}
        &lt;div class="wrap"&gt;
            {{{body}}}
            &lt;hr/&gt;
            注意标题-title
            我在layout页面
        &lt;/div&gt;
    {{&gt; body_footer}}
&lt;/html&gt;
</code></pre>

<p>/public/css/style.css文件自己随便写的，就不贴代码出来了
+ 访问地址：首页：127.0.0.1:3000/ <br />
<img src="/common/img/2015/01/28/block_index.jpg" alt="首页" title="" /> <br />
+ 访问地址：测试页：127.0.0.1:3000/test/
<img src="/common/img/2015/01/28/block_test.jpg" alt="测试" title="" />  </p>

<h3>自定义hbs的模块目录</h3>

<p>首先定义模块目录下的文件：随便定义4个如下：
/views/blockdirs/block_1.html</p>

<pre><code>&lt;p&gt;我是block_1的值&lt;/p&gt;
</code></pre>

<p>/views/blockdirs/block_2.html</p>

<pre><code>&lt;p&gt;我是block_2的值&lt;/p&gt;
</code></pre>

<p>/views/blockdirs/block_3.html</p>

<pre><code>&lt;p&gt;我是block_3的值&lt;/p&gt;
</code></pre>

<p>/views/blockdirs/block_4.html</p>

<pre><code>&lt;p&gt;我是block_4的值&lt;/p&gt;
</code></pre>

<p>在/index.js的添加：  </p>

<pre><code>hbs.registerPartials(__dirname+"/views/blockdirs");
</code></pre>

<p>(注意：此处的模块目录是缓存到服务器，修改模块目录下文件后需要重启服务器，如需自动读取最新模块，请自己写自动读取模块的程序~~~~) <br />
新建文件来加载模块目录里面文件，如下： <br />
/views/blockdirs.html</p>

<pre><code>&lt;h1&gt;我在模塊配置文件實例目錄，下面將引入blockdirs裡面的模塊&lt;/h1&gt;
&lt;hr/&gt;
{{&gt; block_1}}
{{&gt; block_2}}
{{&gt; block_3}}
{{&gt; block_4}}
</code></pre>

<p>为新文件增加新路由，在/index.js的添加：</p>

<pre><code>app.get("/blockdirs/", function(req, res){
    res.render("blockdirs", {
        title: "模块配置目录页面",
        test_value: "这是模块配置目录给出的一个变量值lalala"
    })
})
</code></pre>

<p>+ 访问地址：首页：127.0.0.1:3000/blockdirs/ <br />
<img src="/common/img/2015/01/28/blockdirs.jpg" alt="模块目录页面" title="" /> </p>

<p>demo: <a href="http://hbs-test.clary.cc">demo地址</a> <br />
hbs-test-source: https://github.com/donpark/hbs.git</p>
			</div>
		</section>
		<%- include ../block/body_footer %>
	</body>
</html>